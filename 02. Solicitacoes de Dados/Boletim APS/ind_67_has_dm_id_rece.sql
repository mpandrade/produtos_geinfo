select 
	r.cd_usu_cadsus,
	min(r.dt_receituario)::date as dt_inicial,
	max(case when ri.cod_pro in ('4142716', '4143515', '4142717', '4144807', '4146748', '4143447', '4143446', '4144638', '4142882',
				   '4142937', '4143714', '4144825', '4143806') then 1 else 0 end) as fl_has,
	max(case when ri.cod_pro in ('4034', '3657', '4148079', '4144307', '4144659', '4146882', '4146884', '4142996', '4144657', '4144658',
				   '4143614', '4143613', '3656', '4144660', '4142994', '4142995', '4144656', '4144717', '4144816', '4144730',
				   '4143329', '4144810') then 1 else 0 end) as fl_dm
from 
	receituario r 
	join receituario_item ri on ri.cd_receituario = r.cd_receituario
where 
	(ri.cod_pro in ('4142716', '4143515', '4142717', '4144807', '4146748', '4143447', '4143446', '4144638', '4142882', '4142937', '4143714', '4144825', '4143806')
		or ri.cod_pro in ('4034', '3657', '4148079', '4144307', '4144659', '4146882', '4146884', '4142996', '4144657', '4144658',
				   '4143614', '4143613', '3656', '4144660', '4142994', '4142995', '4144656', '4144717', '4144816', '4144730',
				   '4143329', '4144810'))
	and dias_tratamento > 90
	and r.cd_receita = 1
group by 1